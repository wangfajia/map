var app={};app.map=null;app.label=null;app.lng=109.384;app.lat=31.425;app.zoom=8;app.markers=[];app.markerClusterer=null;app.scaleControl=null;app.drawingManager=null;
app.customPolygon=null;app.visibleZoom=10;app.styleOptions={strokeColor:"#009ad6",fillColor:"#009ad6",strokeWeight:3,strokeOpacity:0.95,fillOpacity:0.15,strokeStyle:"solid"};
function initialize(){var c=new BMap.TileLayer({isTransparentPng:true});c.getTilesUrl=function(g,f){var e=g.x,h=g.y;return"maptile/roadmap/"+f+"/"+e+"/"+h+".png";
};BMAP_NORMAL_MAP=new BMap.MapType("地图",c,{minZoom:3,maxZoom:19});var b=new BMap.TileLayer({isTransparentPng:true});b.getTilesUrl=function(g,f){var e=g.x,h=g.y;
return"maptile/overlay/"+f+"/"+e+"/"+h+".png";};var a=new BMap.TileLayer({isTransparentPng:true});a.getTilesUrl=function(g,f){var e=g.x,h=g.y;return"maptile/satellite/"+f+"/"+e+"/"+h+".jpg";
};BMAP_HYBRID_MAP=new BMap.MapType("卫星图",[a,b],{minZoom:3,maxZoom:18});BMAP_SATELLITE_MAP=new BMap.MapType("BMAP_SATELLITE_MAP",[a],{minZoom:3,maxZoom:19});
app.map=new BMap.Map("map_canvas",{mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]});app.map.addControl(new BMap.NavigationControl({anchor:BMAP_ANCHOR_TOP_LEFT}));
app.map.enableScrollWheelZoom();app.map.enableContinuousZoom();app.map.enableInertialDragging();app.map.enableKeyboard();app.map.addControl(new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]}));
app.map.centerAndZoom(new BMap.Point(app.lng,app.lat),app.zoom);app.map.setMapType(BMAP_NORMAL_MAP);app.map.addControl(new BMap.ScaleControl({offset:new BMap.Size(20,2),anchor:BMAP_ANCHOR_BOTTOM_RIGHT}));
app.map.addControl(new BMap.OverviewMapControl({isOpen:false}));initDrawingManager();var d={gridSize:60,maxZoom:12};app.markerClusterer=new BMapLib.MarkerClusterer(app.map,d);
}function initDrawingManager(){var a=function(f){if(f.drawingMode!=BMAP_DRAWING_MARKER){clearOverlay();}var b="";if(f.drawingMode==BMAP_DRAWING_MARKER){var c=f.overlay,k=c.getPosition();
app.map.removeOverlay(c);app.tempMarkerCount=app.tempMarkerCount+1;var j=getUniqueId(),h="我的标记 "+(getPOICount()+1).toString();addPOI(j,h,k.lat,k.lng,"",true,false);
}else{if(f.drawingMode==BMAP_DRAWING_CIRCLE){b=f.overlay.getCenter().lng+","+f.overlay.getCenter().lat+","+f.overlay.getRadius();}else{if(f.drawingMode==BMAP_DRAWING_POLYLINE||f.drawingMode==BMAP_DRAWING_POLYGON||f.drawingMode==BMAP_DRAWING_RECTANGLE){var g=f.overlay.getPath();
if(f.drawingMode==BMAP_DRAWING_RECTANGLE){b=g[0].lng.toFixed(5)+","+g[0].lat.toFixed(5)+","+g[2].lng.toFixed(5)+","+g[2].lat.toFixed(5);}else{for(var d=g.length-1;
d>=0;d--){if(b){b=b+","+g[d].lng.toFixed(5)+","+g[d].lat.toFixed(5);}else{b=g[d].lng.toFixed(5)+","+g[d].lat.toFixed(5);}}}app.customPolygon=f.overlay;
}}}if(app.label){app.map.removeOverlay(app.label);}app.label=f.label;if(f.drawingMode!=BMAP_DRAWING_MARKER){f.overlay.enableEditing();f.overlay.addEventListener("lineupdate",function(){});
}app.drawingManager.close();};app.drawingManager=new BMapLib.DrawingManager(app.map,{isOpen:false,enableCalculate:true,drawingToolOptions:{anchor:BMAP_ANCHOR_TOP_RIGHT,offset:new BMap.Size(26,11),scale:0.45,drawingModes:[BMAP_DRAWING_MARKER,BMAP_DRAWING_POLYLINE,BMAP_DRAWING_POLYGON,BMAP_DRAWING_RECTANGLE]},enableDrawingTool:true,circleOptions:app.styleOptions,polylineOptions:app.styleOptions,polygonOptions:app.styleOptions,rectangleOptions:app.styleOptions});
app.drawingManager.addEventListener("overlaycomplete",a);app.map.addEventListener("moveend",function(){var b=app.map.getCenter();});app.map.addEventListener("rightclick",clearAllOverlays);
app.map.addEventListener("mousemove",function(d){var c=d.point.lat,b=d.point.lng;});app.map.addEventListener("zoomend",function(){var b=this.getZoom();
});}function addLabel(a,c){var b=new BMap.Label(c,{position:a,enableMassClear:false,offset:new BMap.Size(-45,-25)});b.setStyle({borderColor:"#808080",color:"#333",padding:"1px 3px 1px 3px",borderRadius:"3px",backgroundColor:"#F4F4F4"});
app.map.addOverlay(b);app.label=b;}function calculateAera(e,d){var c=0;if(BMapLib.GeoUtils){var b=d;var g=false;var f=e.toString();switch(f){case"[object Polyline]":c=BMapLib.GeoUtils.getPolylineDistance(e);
break;case"[object Polygon]":c=BMapLib.GeoUtils.getPolygonArea(e);b=e.getBounds().getCenter();g=true;break;case"[object Circle]":var a=e.getRadius();c=Math.PI*a*a;
b=e.getCenter();g=true;break;}if(!c||c<0){c=0;}else{c=c.toFixed(3);}addLabel(b,formatCalculateResult(c,g));}}function getOverlayLatlngs(c){var j=0,a="",f=true,b=null,h=null,g=c.toString();
switch(g){case"[object Polyline]":f=false;h=c.getPath();b=h[h.length-1];j=BMapLib.GeoUtils.getPolylineDistance(c);break;case"[object Polygon]":b=c.getBounds().getCenter();
j=BMapLib.GeoUtils.getPolygonArea(c);h=c.getPath();if(h.length<0){a=h[0].lng.toFixed(5)+","+h[0].lat.toFixed(5)+","+h[2].lng.toFixed(5)+","+h[2].lat.toFixed(5);
}else{for(var d=h.length-1;d>=0;d--){if(a){a=a+","+h[d].lng.toFixed(5)+","+h[d].lat.toFixed(5);}else{a=h[d].lng.toFixed(5)+","+h[d].lat.toFixed(5);}}}break;
case"[object Circle]":var e=c.getRadius();b=c.getCenter();j=Math.PI*e*e;a=c.getCenter().lng+","+c.getCenter().lat+","+c.getRadius();break;}if(app.label){app.label.setContent(formatCalculateResult(j,f));
app.label.setPosition(b);app.label.setOffset(new BMap.Size(-45,-25));}return a;}function clearOverlay(){var b=app.map.getOverlays();for(var a=0;a<b.length-3;
a++){if(b[a].toString()!="[object Marker]"){app.map.removeOverlay(b[a]);}}b.length=0;}function clearAllOverlays(){app.map.clearOverlays();app.markers=[];
app.markerClusterer.clearMarkers();}function setCenterAndZoom(c,a,b){app.map.centerAndZoom(new BMap.Point(a,c),b);}function getPOIMarker(c){var b=0,a=null;
for(b=0;b<app.markers.length;b++){a=app.markers[b];if(a.id===c){return a;}}return null;}function deletePOIMarker(c){var b=0,a=null;for(b=app.markers.length-1;
b>=0;b--){a=app.markers[b];if((a)&&(a.id===c)){app.map.removeOverlay(a.label);app.map.removeOverlay(a);app.markers.splice(b,1);}}}function deleteTempPOIMarkers(){if(app.tempMarkerCount===0){return;
}var b=0,a=null;for(b=app.markers.length-1;b>=0;b--){a=app.markers[b];if((a)&&(a.isTemp)){app.map.removeOverlay(a.label);app.map.removeOverlay(a);app.markers.splice(b,1);
}}app.tempMarkerCount=0;}function getPOICount(){return app.markers.length;}function addPOI(d,c,h,i,g,f,b){var j=new BMap.Point(i,h),e=getPOIMarker(d);if(e){if(e.isTemp){e.setIcon(new BMap.Icon("mapfiles/icons/marker-red.png",new BMap.Size(32,32)));
}e.setTitle(c);e.setPosition(j);e.isTemp=false;e.content=g;e.label.setContent(c);e.label.setPosition(j);}else{var a=(f)?"mapfiles/icons/marker-blue.png":"mapfiles/icons/marker-red.png";
e=new BMap.Marker(j,{enableMassClear:false,enableDragging:true,raiseOnDrag:false,icon:new BMap.Icon(a,new BMap.Size(32,32)),title:c});e.id=d;e.isTemp=f;
e.content=g;app.markers.push(e);app.map.addOverlay(e);e.label=new BMap.Label(c,{position:j,enableMassClear:false,offset:new BMap.Size(-35,-35)});e.label.setStyle({borderColor:"#808080",color:"#333",padding:"1px 3px 1px 3px",borderRadius:"3px",backgroundColor:"#F4F4F4"});
app.map.addOverlay(e.label);}e.addEventListener("click",function(){var l=this.getPosition();});e.addEventListener("dragend",function(){var l=this.getPosition();
});e.addEventListener("dragging",function(){this.label.setPosition(this.getPosition());});e.addEventListener("dragstart",function(){this.label.setPosition(this.getPosition());
});if(b){var k=app.map.getZoom();app.map.centerAndZoom(j,(k<14)?14:k);}}