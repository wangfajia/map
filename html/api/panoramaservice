_jsload&&_jsload('panoramaservice', 'var mf=5;Db.uy="http://pcsv0.map.bdimg.com";Db.$o=Db.uy+"/scape/?";Db.JF=Db.$o+"udt=20140102&qt=pdata&pos=0_0&z=0&sid=";Db.AF="http://map.baidu.com/?qt=pver";Db.Ck=new P; t.extend(Db.prototype,{jG:function(){this.La?this.fl(this.La,this.Nf):this.Qt&&this.Ph(this.Qt,this.EI,this.Nf)},fl:function(a,b,c){this.pz(Db.$o+"qt=scb&l=17&sid="+a+"&fn=",b,c)},Ph:function(a,b,c){"function"==typeof b&&(c=b,b=50);a=Db.Ck.jo(a);this.pz(Db.$o+"qt=qscb&x="+a.x+"&y="+a.y+"&r="+b+"&action=1&fn=",c)},TL:function(a){this.Zm(Db.AF+"&callback=",function(b){b?a&&a(b):a&&a(n)})},pz:function(a,b,c){var d=this;this.Zm(a,function(a){a&&a.result&&0==a.result.error?b&&b(d.aI(a,c)):b&&b(n)})},Zm:function(a, b){var c=(1E5*Math.random()).toFixed(0);B._rd=B._rd||{};B._rd["_cbk"+c]=function(a){b&&b(a);delete B._rd["_cbk"+c]};Ra(a+("BMap._rd._cbk"+c))},aI:function(a,b){var c={},d=a.content[0];c.description=d.Rname||d.Info||"";c.id=d.ID;c.Cf=d.X/100;c.Df=d.Y/100;c.position=Db.Ck.di(new O(c.Cf,c.Df));c.links=this.bI(d,c.id);c.mode=d.Mode;c.relevants=[];if(d.SwitchID)for(var e=0;e<d.SwitchID.length;e++)c.relevants[e]={id:d.SwitchID[e].ID,mode:d.SwitchID[e].Time.toLowerCase()};c.tiles=new nf({dirNorth:d.NorthDir, centerHeading:(180+d.NorthDir)%360,pitch:d.Pitch});d.Enters&&0<d.Enters.length&&(e=d.Enters[0],c.iid=e.IID,c.poi={title:e.Name,Cf:e.X/100,Df:e.Y/100});c.photos=[];if(d.Photos)for(var f=d.Photos,e=0;e<f.length;e++)c.photos.push({EM:Db.JF+f[e].PID,DN:f[e].PID,name:f[e].Name});var f=[],g=d.VPoint;if(g)for(var j=g.length,e=0;e<j;e++){var k={};k.PID=g[e].PID;var l=Db.Ck.di(new O(g[e].X/100,g[e].Y/100));k.X=6378137*-(l.lat-c.position.lat)/180*Math.PI;k.Z=6378137*(l.lng-c.position.lng)/180*Math.PI;f.push(k)}c.VPoint= f;d.Inters&&0<d.Inters.length&&(c.eg=d.Inters[0].BreakID,c.heading=d.MoveDir,c.pitch=d.Pitch);b&&(c.eg=b.eg);return c},bI:function(a,b){var c=[];if(a.Links)for(var d=0;d<a.Links.length;d++)c.push({id:a.Links[d].PID,dir:a.Links[d].DIR,heading:a.Links[d].DIR});if(!a.Roads)return c;for(d=0;d<a.Roads.length;d++)if(a.Roads[d].Panos)for(var e=0;e<a.Roads[d].Panos.length;e++){if(a.Roads[d].Panos[e].PID==b){var f=a.Roads[d].Name;""==f&&(f=a.Rname||"\\u672a\\u77e5");for(var g=n,j=n,k=e-1;k<e;k++)if(a.Roads[d].Panos[k]){g= a.Roads[d].Panos[k];break}g!=n&&c.push({id:g.PID,dir:(g.DIR+180)%360,heading:(g.DIR+180)%360,description:f});for(k=e+1;k>e;k--)if(a.Roads[d].Panos[k]){j=a.Roads[d].Panos[k];break}j!=n&&(g=j.DIR,0==g&&(g=a.Roads[d].Panos[e].DIR),c.push({id:j.PID,dir:g,heading:g,description:f}))}for(k=0;k<c.length;k++)a.Roads[d].Panos[e].PID==c[k].id&&(c[k].description=a.Roads[d].Name,""==c[k].description&&(c[k].description=a.Rname||"\\u672a\\u77e5"))}return c}});Yc=Db.prototype;U(Yc,{getPanoramaById:Yc.fl,getPanoramaByLocation:Yc.Ph});function nf(a){this.tileSize=new L(512,512);this.worldSize=new L(512*this.Sh(mf),512*this.gr(mf));this.centerHeading=180;var a=a||{},b;for(b in a)this[b]=a[b]}var of=["http://pcsv0.map.bdimg.com/scape/","http://pcsv1.map.bdimg.com/scape/","http://pcsv2.map.bdimg.com/scape/"]; t.extend(nf.prototype,{getTilesUrl:function(a,b,c){return of[(b.x+b.y)%of.length]+"?qt=pdata&sid={sid}&pos={y}_{x}&z={zoom}".replace("{sid}",a).replace("{x}",b.x).replace("{y}",b.y).replace("{zoom}",c)},gr:function(a){return Math.pow(2,a-2)},Sh:function(a){return 2*this.gr(a)}}); ');
